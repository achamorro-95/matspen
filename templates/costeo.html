{% extends "base.html" %}
{% block title %}Costeo{% endblock %}
{% block content %}

<h1>Pagina de Costos</h1>

<!-- ======================================================
     FORMULARIO PRINCIPAL
     ====================================================== -->
<form method="post" class="form-box" id="form-costeo">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <input type="hidden" name="accion" value="calcular">
    <div class = "seleccion-group">
        <input type="hidden" name="tipo_impresion" id="tipo_impresion" value="Offset">
        <button type="button" class="seleccion-offset active" id="btnOffset">Offset</button>
        <button type="button" class="seleccion-digital" id="btnDigital">Digital</button>
    </div>
    <div id="boxOffset">

  <div class="card">
    <div class="grid">
      <input type="number" step="0.01" name="ancho_arte" placeholder="Ancho (cm)" value = "{{ editando.ancho_arte if editando else '' }}">
      <input type="number" step="0.01" name="alto_arte" placeholder="Alto (cm)" value = "{{ editando.alto_arte if editando else '' }}">
      <input type="number" name="artes" placeholder="Cantidad de artes" value = "{{ editando.artes if editando else '' }}">

      <input type="number" name="imp_total" placeholder="Tiraje total" value = "{{ editando.cantidades if editando else '' }}">
      <input type="number" step="0.01" name="troquel" placeholder="Costo de troquel" value = "{{ editando.troquel if editando else '' }}">

      <select class="material" name="material" required>
        <option value="">Selecciona Material</option>
        {% for m in materiales %}
          <option value="{{ m.id }}" {% if editando and editando.material_id == m.id %}selected{% endif %}>{{ m.nombre }}</option>
        {% endfor %}
      </select>

      <select name="vendedor" required>
        <option value="">Selecciona Vendedor</option>
        {% for v in vendedores %}
          <option value="{{ v.id }}" {% if editando and editando.vendedor_id == v.id %}selected{% endif %}>{{ v.nombre }}</option>
        {% endfor %}
      </select>
      <select name="cliente" required>
        <option value="">Selecciona Cliente</option>
        {% for c in clientes %}
          <option value="{{ c.id }}" {% if editando and editando.cliente_id == c.id %}selected{% endif %}>{{ c.nombre }}</option><br>
        {% endfor %}
      </select>
      <div class="barniz-row">
        <label class="switch">
          <input type="checkbox" name="barniz" value="si" {% if editando and editando.barniz == 'Si' %}checked{% endif %}>
          <span class="slider"></span>
        </label>
        <span>Lleva Barniz</span>
      </div>
    </div>
    <div style="margin-top:14px; text-align:right;">
      <button type="submit">Calcular Costo</button>
  </div>
  </form>
  <!-- TABLA (más abajo) -->
  <div class="card table-card">
    <div class="table-head">
      <h3>Costos calculados</h3>
    </div>

    <div class="tabla_costo">
      <table>
        <thead>
          <tr>
            <th>Cliente</th>
            <th>Vendedor</th>
            <th>Material</th>
            <th>Cantidades</th>
            <th>Barniz</th>
            <th>Resmas</th>
            <th>Costo Total</th>
          </tr>
        </thead>
        <tbody id="tablaCostosBody">
          {% for c in costos_calculados %}
          <tr>
            <td>{{ c.cliente }}</td>
            <td>{{ c.vendedor }}</td>
            <td>{{ c.material }}</td>
            <td>{{ c.cantidades }}</td>
            <td>{{ c.barniz }}</td>
            <td>{{ c.resmas }}</td>
            <td>${{ c.costo_total }}</td>
            
            <td> 
                <form method="POST" action="/costeo/eliminar/{{ c.id }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit"
                        style="padding:6px 10px; border:none; border-radius:6px;
                                background:#c62828; color:white; cursor:pointer;"
                        onclick="return confirm('¿Seguro que deseas eliminar este costo?');">
                    Eliminar</button>

                </form>
            </td>
            <td>
                <form method="POST" action="/costeo/editar/{{ c.id }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit"
                        style="padding:6px 10px; border:none; border-radius:6px;
                                background:#2e7d32; color:white; cursor:pointer;">
                    Editar</button>

                </form>
            </td>
          </tr>
          {% endfor %}
        </tbody>
        {% if costos_calculados %}
        <form method="POST" action ="/costeo/guardar">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <button type="submit"
                style="margin-top:10px; padding:8px 14px; border:none; border-radius:6px;
                        background:#1565c0; color:white; cursor:pointer;">
            Guardar Costos</button>

                
        </form>
        {% endif %}
      </table>
    </div>
  </div>

</div>


        <div id="boxDigital" style="display:none;">
        <!-- aquí van campos de digital (por ahora ejemplo) -->
        <input type="number" step="0.01" name="precio_base_digital" placeholder="Precio base digital">
        </div>

<style>

button{
    padding: 10px 14px;
    border: none;
    border-radius: 8px;
    background: #b11226;
    color: white;
    cursor: pointer;
}
    /* Tarjetas */
.card{
  background: white;
  border: 1px solid #eee;
  border-radius: 12px;
  padding: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,.06);
}

/* Grid para inputs */
.grid{
  display: grid;
  grid-template-columns: repeat(3, minmax(180px, 1fr));
  gap: 12px;
  align-items: end;
}

/* Que los select e inputs se vean iguales */
.grid input, .grid select{
  width: 100%;
  padding: 10px;
  border-radius: 10px;
  border: 1px solid #ddd;
}

/* fila del barniz ocupa una celda completa si quieres */
.barniz-row{
  display:flex;
  align-items:center;
  gap:10px;
}

/* Empujar la tabla hacia abajo */
.table-card{
  margin-top: 30px; /* <-- aquí controlas qué tan abajo queda */
}

/* Encabezado de la tabla */
.table-head{
  display:flex;
  justify-content: space-between;
  align-items:center;
  margin-bottom: 10px;
}
.table-head h3{
  margin: 0;
  font-size: 16px;
  font-weight: 800;
}

/* Tabla */
.tabla_costo{
  margin-top: 10px;
}
table th{
  background: #f7f7f7;
  text-align: left;
}

</style>
<script>
const btnOffset = document.getElementById("btnOffset");
const btnDigital = document.getElementById("btnDigital");
const tipoHidden = document.getElementById("tipo_impresion");

const boxOffset = document.getElementById("boxOffset");
const boxDigital = document.getElementById("boxDigital");

function setTab(tipo){
  tipoHidden.value = tipo;

  if(tipo === "Offset"){
    boxOffset.style.display = "block";
    boxDigital.style.display = "none";
    btnOffset.classList.add("active");
    btnDigital.classList.remove("active");
  } else {
    boxOffset.style.display = "none";
    boxDigital.style.display = "block";
    btnDigital.classList.add("active");
    btnOffset.classList.remove("active");
  }
}

btnOffset.addEventListener("click", () => setTab("Offset"));
btnDigital.addEventListener("click", () => setTab("Digital"));

// default
setTab("Offset");
</script>

        
{% endblock %}
